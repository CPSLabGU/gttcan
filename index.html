<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>gttcan: G-TTCan</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">gttcan
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">G-TTCan </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__github_workspace_README"></a>A time-triggered CAN Bus communication protocol loosely based on TTCan</p>
<p >Each node on the network will need to be able to communicate at 1mbps on the CAN Bus. The NTU (Network Time Unit) is 0.1us. Each device should maintain its own local time at best-effort resolution. No device on the network should start transmitting until it has received a start of schedule [Reference Message](reference-message) to make sure it is synchronised with the other devices.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Schedule</h1>
<p >The schedule is the basis of the protocol. The exact implementation can be decided by the user, but the following information is required.</p>
<p ><em>Schedule Length</em> - How many entries in one round of the schedule.</p>
<p ><em>Entry Duration</em> - How long (in NTU) each entry in the schedule is alloted. Must be greater than the tranmission time for a single can frame (in NTU).</p>
<p ><em>Schedule Data</em> - The schedule data itself. This does not need to be stored on each node, or anywhere even, however the information from the schedule must be used to generate each node's <em>local schedule</em>. In practice, it may be desirable for every node to have the full schedule.</p>
<p >The schedule can be stored as a series of entries (of length <em>Schedule Length</em>). Each entry contains a node ID and a data ID. For a typical use case, each of these can be encoded as a byte, though for larger networks/data structures, these could be encoded as 2 bytes each. There are 4 types of entries in the schedule:</p>
<h3><a class="anchor" id="autotoc_md2"></a>
Reference message slot</h3>
<p >Node ID: 1-7 (depending on which time master is transmitting)\ Data ID: 0\ A slot for Reference messages to be sent.</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Exclusive message slot</h3>
<p >ID: 1 - (2^NUM_ID_BITS)-1 (ID of Node that should transmit in this slot)\ DataID: 1 - (2^NUM_DATAID_BITS)-1. \ This is the most common entry in the schedule. The Data value is application specific, but allows for nodes to transmit specific information in a specific schedule entry (and thus one node may appear multiple times in the schedule, but with different data values). If all nodes share a common data structure (similar to an Object Dictionary in CANOpen), this number could be an index into that data structure. This can also allow all nodes to act as consumers of the messages as they know which node transmitted and what entry should be updated.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Arbitration message slot</h3>
<p >ID: 2^NUM_ID_BITS\ DataID: 2^NUM_DATAID_BITS\ This is a "generic" message slot that allows for ad-hoc or on-request messages to be sent by nodes. In the event that multiple nodes wish to transmit an ad-hoc message, CANBus arbitration will determine which node can transmit in this window. IF a node loses arbitration, it can attempt to send again in the next arbitration message slot.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
Free Slot</h3>
<p >ID: 0\ Data: 0\ This is an empty entry in the schedule that allows for the network to be expanded by adding Exclusive/Arbitration messages</p>
<p >It is important to note that only 29 bits are available in the CAN Frame header id field, so NUM_ID_BITS + NUM_DATAID_BITS must be &lt;= 29.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Messages</h1>
<h3><a class="anchor" id="autotoc_md7"></a>
29 bit ID for CAN Frame Header</h3>
<p >All messages should be sent using extended can frame ID's. This allows for a 29bit ID field to be transmitted with each frame, which is used to transmit both the schedule index and the data field id.</p>
<p >The bit formatting is as follows: </p><div class="fragment"><div class="line">0 x (29-NUM_ID_BITS-NUM_DATAID_BITS)</div>
<div class="line">i x SCHEDULE_ID_BITS</div>
<div class="line">d x NUM_DATAID_BITS</div>
<div class="line"> </div>
<div class="line">i = Schedule index value</div>
<div class="line">d = Data ID value</div>
<div class="line"> </div>
<div class="line">For an 14 bit schedule index and a 14 bit data slot ID, the CAN Frame ID value would look like this:</div>
<div class="line">0iiiiiiiiiiiiiidddddddddddddd</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8"></a>
Reference message</h3>
<p >A reference message is a CAN frame sent by a node with an ID of 1-7 (the first 7 ids are reserved for time masters) with a data ID of 0. The first data bit (MSB) is used to indicate that this reference frame is the first frame in the schedule. This allows for the schedule to contain multiple reference messages for tighter time synchronisation. This is followed by a reserved bit and then 62 timing bits.</p>
<h4><a class="anchor" id="autotoc_md9"></a>
8 byte (64 bit) Data payload for reference messages</h4>
<div class="fragment"><div class="line">SRtttttt tttttttt tttttttt tttttttt</div>
<div class="line">S = Start of schedule (0/1)</div>
<div class="line">R = reserved</div>
<div class="line">t = timevalue (62 bit)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md10"></a>
Standard Message</h3>
<p >A standard message has the full 8 bytes available for data transmission. Although the schedule slot dictates what data will be sent, the Data ID value should still be encoded in the least-significant bits in the Can Frame ID.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Nodes</h1>
<p >Each node on the G-TTCan network will need the following information:</p>
<p ><em>Node ID(s)</em>: The ID(s) to be used for this node. Node ID's 1-7 are reserved for time masters. It is <em>possible</em> for a node to identify/respond as 2 IDs (schizophrenic node) however this may introduce unexpected complexity or behaviour and should be carefully considered.</p>
<p ><em>Current Time</em>: The current network time (in units of 0.1 us). This should be syncrhonised when receiving a [Reference Message](reference-message) and maintained at best-effort resolution by the node.</p>
<p ><em>Schedule Length</em> - How many entries in one round of the schedule.</p>
<p ><em>Entry Duration</em> - How long (in NTU) each entry in the schedule is alloted. Must be greater than the tranmission time for a single can frame (in NTU).</p>
<p ><em>Local Schedule</em> - Each node will need to know when it should transmit in the schedule. This can be stored as a series of &lt;global schedule index - data slot id&gt; pairs (and this will fit inside a single uint32). Each node can calculate the next transmission time by subtracting the current global schedule index from it's next transmission index and multiplying this result (the number of schedule slots until a node must next transmit) by the slot duration.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Masters (TBC)</h2>
<p >Node's with an ID of 1 - 7 are potential master nodes. Primary Master (ID: 1): This node should </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
